<!DOCTYPE html>
<html data-bs-theme="dark" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Dashboard</title>
    <link rel="canonical" href="https://www.nuaimi.us/main/">
    <meta property="og:url" content="https://www.nuaimi.us/main/">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://www.nuaimi.us/assets/img/logos/NLogo.webp">
    <meta name="description" content="Admin/Page">
    <link rel="icon" type="image/png" sizes="960x960" href="../assets/img/logos/NLogo.webp">
    <link rel="icon" type="image/png" sizes="960x960" href="../assets/img/logos/NLogo.webp" media="(prefers-color-scheme: dark)">
    <link rel="icon" type="image/png" sizes="960x960" href="../assets/img/logos/NLogo.webp">
    <link rel="icon" type="image/png" sizes="960x960" href="../assets/img/logos/NLogo.webp" media="(prefers-color-scheme: dark)">
    <link rel="icon" type="image/png" sizes="960x960" href="../assets/img/logos/NLogo.webp">
    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Advent+Pro:500,600,600i,700,700i,800i&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bad+Script&amp;display=swap">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/bss-overrides.css">
    <link rel="stylesheet" href="../assets/css/animate.min.css">
    <link rel="stylesheet" href="../assets/css/Animated-Type-Heading.css">
    <link rel="stylesheet" href="../assets/css/border.compiled.css">
    <link rel="stylesheet" href="../assets/css/index.css">
    <link rel="stylesheet" href="../assets/css/store.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&display=swap">
</head>

<body>
    <nav class="navbar navbar-expand-lg mb-7 pb-2" style="padding-top: 29px;font-family: 'Advent Pro';" data-bs-theme="dark">
        <div class="container"><a class="navbar-brand d-flex align-items-center" data-bs-target="#toast-1" data-bs-toggle="toast"><img data-bss-hover-animate="pulse" src="../assets/img/logos/NLogo.webp" width="106" height="100" style="padding: 0;margin: -16px;"></a><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-3"><span class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse text-white-50" id="navcol-3" style="--bs-primary: #0ebae0;--bs-primary-rgb: 14,186,224;font-family: Advent Pro;font-weight: bold;">
                <ul class="navbar-nav ms-auto mb-4 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" data-bss-disabled-mobile="true" data-bss-hover-animate="pulse" href="/index.html" style="text-align: center;">Home</a></li>
                    <li class="nav-item protectedContent" style="display:none;"><a class="nav-link" data-bss-disabled-mobile="true" data-bss-hover-animate="pulse" href="/contacts.html" style="color: #fcfbfb;text-align: center;"><strong>Contacts</strong></a></li>
                    <li class="nav-item protectedContent" style="display:none;"><a class="nav-link" data-bss-disabled-mobile="true" data-bss-hover-animate="pulse" href="/services.html" style="color: #fcfbfb;text-align: center;"><strong>Services</strong></a></li>
                    <li class="nav-item"><a class="nav-link" href="/privacy-policy.html" style="color: #fcfbfb;text-align: center;font-family: Advent Pro;"><strong>Privacy Policy</strong></a></li>
                    <li class="nav-item dropdown justify-content-center auth"><a class="nav-link text-center auth" aria-expanded="false" data-bs-toggle="dropdown" href="#"><i class="fa fa-user" style="font-size: 26px;color: var(--bs-primary);"></i></a>
                        <div class="dropdown-menu dropdown-menu-end text-center auth" style="background: rgba(33,37,41,0.25);"><a class="dropdown-item publicContent" data-bs-target="#toast-1" data-bs-toggle="toast" href="login.html">LOGIN</a><a class="dropdown-item protectedContent" href="profile.html">PROFILE</a><a class="dropdown-item protectedContent" href="user-settings.html">SETTINGS</a><a class="dropdown-item publicContent" href="signup.html">SIGNUP</a><a class="dropdown-item signOut protectedContent" id="signOut">SIGN-OUT</a></div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <h2 id="userCount" style="text-align: center;font-family: Advent Pro;color: var(--bs-primary);">Loading user count...</h2>
    <div class="table-responsive-lg ps-4 pe-4">
        <table class="table table-striped table-bordered" id="userTable">
            <thead class="ps-0">
                <tr class="ms-0 ps-0 mb-0" style="font-family: Advent Pro;font-size: 1em;">
                    <th class="text-center" style="background: var(--bs-primary);color: rgb(0,0,0);">#</th>
                    <th class="text-center" style="background: var(--bs-primary);color: rgb(0,0,0);">Full Name</th>
                    <th class="text-center" style="background: var(--bs-primary);color: rgb(0,0,0);">Email</th>
                    <th class="text-center" style="background: var(--bs-primary);color: rgb(0,0,0);">Signup Date</th>
                    <th class="text-center" style="background: var(--bs-primary);color: rgb(0,0,0);">Profile Image</th>
                    <th class="text-center" style="background: var(--bs-primary);color: rgb(0,0,0);">Status</th>
                    <th class="text-center" style="background: var(--bs-primary);color: rgb(0,0,0);">User Power</th>
                </tr>
            </thead>
            <tbody class="text-center gap-1" style="color: var(--bs-primary);font-family: Advent Pro;"></tbody>
        </table>
    </div><script>
document.addEventListener('DOMContentLoaded', async () => {
  const token = localStorage.getItem('token');
  if (!token) {
    location.href = '/login.html';
    return;
  }

  // Step 1: Verify admin access
  try {
    const res = await fetch('https://api.nuaimi.us/me', {
      headers: { Authorization: `Bearer ${token}` }
    });

    const user = await res.json();
    if (!res.ok || !user.is_admin) {
      alert('Access denied. Admins only.');
      location.href = '/index.html';
      return;
    }

    // Step 2: Load and render user dashboard
    loadAdminDashboard(token);
  } catch (err) {
    console.error('Admin check failed:', err);
    location.href = '/login.html';
  }
});

async function loadAdminDashboard(token) {
  try {
    const res = await fetch('https://api.nuaimi.us/users_data', {
      headers: { Authorization: `Bearer ${token}` }
    });

    const users = await res.json();
    if (!res.ok || !Array.isArray(users)) {
      throw new Error('Failed to load user data');
    }

    document.getElementById('userCount').textContent = `Welcome Admin,  Total Users: ${users.length}`;

    const tbody = document.querySelector('#userTable tbody');
    tbody.innerHTML = users.map((user, index) => {
      const fullName = `${user.first_name || ''} ${user.last_name || ''}`.trim();
      const email = user.email || 'â€”';
      const signupDate = new Date(user.created_at).toLocaleDateString();
      const profileImgUrl = user.profile_picture || '/assets/img/default-avatar.png';
      const isActive = user.is_active;
      const isAdmin = user.is_admin;

      return `
        <tr>
          <td>${index + 1}</td>
          <td>${fullName}</td>
          <td>${email}</td>
          <td>${signupDate}</td>
          <td><img src="${profileImgUrl}" alt="Profile" style="width:40px;height:40px;border-radius:50%;object-fit:cover;"></td>
          <td>
            <button class="status-toggle btn btn-sm ${isActive ? 'btn-success' : 'btn-danger'}" data-id="${user._id}" data-active="${isActive}">
              ${isActive ? 'Active' : 'Inactive'}
            </button>
          </td>
          <td>
            <button class="admin-toggle btn btn-sm ${isAdmin ? 'btn-warning' : 'btn-secondary'}" data-id="${user._id}" data-admin="${isAdmin}">
              ${isAdmin ? 'Admin' : 'User'}
            </button>
          </td>
        </tr>
      `;
    }).join('');

    // Step 3: Add toggle handlers
    document.querySelectorAll('.status-toggle').forEach(button => {
      button.addEventListener('click', async function () {
        const userId = this.dataset.id;
        const newStatus = this.dataset.active !== 'true';

        const patchRes = await fetch(`https://api.nuaimi.us/users_data/${userId}`, {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({ is_active: newStatus })
        });

        if (patchRes.ok) {
          this.textContent = newStatus ? 'Active' : 'Inactive';
          this.classList.toggle('btn-success', newStatus);
          this.classList.toggle('btn-danger', !newStatus);
          this.dataset.active = newStatus;
        } else {
          alert('Failed to update status');
        }
      });
    });

    document.querySelectorAll('.admin-toggle').forEach(button => {
      button.addEventListener('click', async function () {
        const userId = this.dataset.id;
        const newAdmin = this.dataset.admin !== 'true';

        const patchRes = await fetch(`https://api.nuaimi.us/users_data/${userId}`, {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({ is_admin: newAdmin })
        });

        if (patchRes.ok) {
          this.textContent = newAdmin ? 'Admin' : 'User';
          this.classList.toggle('btn-warning', newAdmin);
          this.classList.toggle('btn-danger', !newAdmin);
          this.dataset.admin = newAdmin;
        } else {
          alert('Failed to update user level');
        }
      });
    });

  } catch (err) {
    console.error('Dashboard load error:', err);
    document.getElementById('userCount').textContent = 'Error loading user data';
  }
}
</script>
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/js/bs-init.js"></script>
    <script src="../assets/js/main.js"></script>
</body>

</html>